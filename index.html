<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeismicWatch | Global Earthquake Monitor</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            margin: 0;
            padding: 0;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .quake-card {
            transition: all 0.2s ease;
        }
        .quake-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        
        /* Pulse Animation for Live Status */
        .ring-container { position: relative; }
        .circle {
            width: 15px; height: 15px;
            background-color: #ef4444;
            border-radius: 50%;
            position: absolute; top: 2px; right: 2px;
        }
        .ringring {
            border: 3px solid #ef4444;
            border-radius: 30px;
            height: 25px; width: 25px;
            position: absolute; left: -3px; top: -3px;
            animation: pulsate 1s ease-out infinite; 
            opacity: 0.0;
        }
        @keyframes pulsate {
            0% { transform: scale(0.1, 0.1); opacity: 0.0; }
            50% { opacity: 1.0; }
            100% { transform: scale(1.2, 1.2); opacity: 0.0; }
        }

        /* Tsunami Pulse */
        @keyframes tsunami-pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .tsunami-active {
            animation: tsunami-pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center; background-color: #0f172a; color: #64748b; font-family: sans-serif;">
            Initializing SeismicWatch...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Activity: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
                Filter: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
                MapPin: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
                Globe: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
                RefreshCw: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
                Clock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                AlertTriangle: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
                Search: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
                X: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
                Waves: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></svg>,
                Code: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
                Users: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
                Navigation: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
                Share: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
            };
            return icons[name] || null;
        };

        // --- Helpers & Logic ---

        const US_IDENTIFIERS = new Set([
            'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY', 'DC',
            'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming', 'District of Columbia'
        ]);

        const normalizeRegion = (placeStr) => {
            if (!placeStr) return "Unknown";
            const parts = placeStr.split(', ');
            if (parts.length > 1) {
                const regionCandidate = parts[parts.length - 1].trim();
                if (US_IDENTIFIERS.has(regionCandidate)) return "United States";
                if (regionCandidate === 'USA') return "United States";
                return regionCandidate;
            } else {
                if (placeStr.includes("United States")) return "United States";
                return "International / Ocean";
            }
        };

        const formatTime = (timestamp) => {
            if (!timestamp) return 'Unknown';
            return new Date(timestamp).toLocaleString('en-US', {
                month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });
        };

        const getTimeAgo = (timestamp) => {
            if (!timestamp) return '';
            const seconds = Math.floor((new Date() - timestamp) / 1000);
            if (seconds < 60) return `${seconds}s ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            return `${days}d ago`;
        };

        const getMagnitudeColor = (mag) => {
            const m = parseFloat(mag) || 0;
            if (m < 3.0) return 'text-emerald-400 border-emerald-400/30 bg-emerald-400/10';
            if (m < 5.0) return 'text-yellow-400 border-yellow-400/30 bg-yellow-400/10';
            if (m < 7.0) return 'text-orange-500 border-orange-500/30 bg-orange-500/10';
            return 'text-red-500 border-red-500/30 bg-red-500/10';
        };
        
        const getMagnitudeBg = (mag) => {
            const m = parseFloat(mag) || 0;
            if (m < 3.0) return 'bg-emerald-500';
            if (m < 5.0) return 'bg-yellow-500';
            if (m < 7.0) return 'bg-orange-500';
            return 'bg-red-500';
        };

        // Haversine Formula for Distance
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // Radius of the earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            const d = R * c; // Distance in km
            return Math.round(d);
        };

        // --- Sub-Components ---

        const StatCard = ({ label, value, iconName, subtext, colorClass }) => (
            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 flex items-center justify-between">
                <div>
                    <p className="text-slate-400 text-xs font-semibold uppercase tracking-wider">{label}</p>
                    <p className="text-2xl font-bold font-mono mt-1 text-white">{value}</p>
                    {subtext && <p className="text-xs text-slate-500 mt-1">{subtext}</p>}
                </div>
                <div className={`p-3 rounded-lg ${colorClass}`}>
                    <Icon name={iconName} size={24} />
                </div>
            </div>
        );

        const Modal = ({ isOpen, onClose, quake, userLocation }) => {
            if (!isOpen || !quake) return null;

            const coords = quake.geometry?.coordinates || [0,0,0];
            const mag = quake.properties?.mag || 0;
            const place = quake.properties?.place || "Unknown Location";
            const felt = quake.properties?.felt || 0;
            const tsunami = quake.properties?.tsunami === 1;
            
            const mapLink = `https://www.google.com/maps/search/?api=1&query=${coords[1]},${coords[0]}`;
            const magColor = getMagnitudeColor(mag);

            const handleShare = () => {
                const text = `ðŸš¨ Earthquake Alert: Mag ${mag.toFixed(1)} in ${place}. ${tsunami ? 'TSUNAMI WARNING.' : ''} Check SeismicWatch.`;
                navigator.clipboard.writeText(text).then(() => alert("Alert copied to clipboard!"));
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="p-6 border-b border-slate-700 flex justify-between items-start">
                            <div>
                                <div className="flex gap-2 mb-3">
                                    <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-bold border ${magColor}`}>
                                        MAG {mag.toFixed(1)}
                                    </div>
                                    {tsunami && (
                                        <div className="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-blue-500 text-white animate-pulse">
                                            ðŸŒŠ TSUNAMI ALERT
                                        </div>
                                    )}
                                </div>
                                <h2 className="text-xl font-bold text-white leading-tight">{place}</h2>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={handleShare} className="p-2 bg-slate-800 rounded-full hover:bg-slate-700 text-slate-400 hover:text-white transition-colors">
                                    <Icon name="Share" size={20} />
                                </button>
                                <button onClick={onClose} className="p-2 bg-slate-800 rounded-full hover:bg-slate-700 text-slate-400 hover:text-white transition-colors">
                                    <Icon name="X" size={20} />
                                </button>
                            </div>
                        </div>

                        <div className="p-6 space-y-6">
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-slate-800 p-4 rounded-xl">
                                    <p className="text-slate-400 text-xs uppercase mb-1">Time</p>
                                    <p className="text-white font-mono">{formatTime(quake.properties.time)}</p>
                                    <p className="text-slate-500 text-xs mt-1">{getTimeAgo(quake.properties.time)}</p>
                                </div>
                                <div className="bg-slate-800 p-4 rounded-xl">
                                    <p className="text-slate-400 text-xs uppercase mb-1">Impact</p>
                                    <div className="flex items-center gap-2">
                                        <Icon name="Users" size={16} className="text-blue-400" />
                                        <p className="text-white font-mono">{felt > 0 ? `${felt} Reports` : 'Not reported'}</p>
                                    </div>
                                    <p className="text-slate-500 text-xs mt-1">Citizen Reports</p>
                                </div>
                                <div className="bg-slate-800 p-4 rounded-xl">
                                    <p className="text-slate-400 text-xs uppercase mb-1">Depth</p>
                                    <p className="text-white font-mono">{coords[2]} km</p>
                                </div>
                                <div className="bg-slate-800 p-4 rounded-xl">
                                    <p className="text-slate-400 text-xs uppercase mb-1">Coordinates</p>
                                    <p className="text-white font-mono text-xs">{coords[1].toFixed(3)}, {coords[0].toFixed(3)}</p>
                                    {userLocation && (
                                        <p className="text-blue-400 text-xs mt-1 font-bold">
                                            {calculateDistance(userLocation.lat, userLocation.lon, coords[1], coords[0])} km away
                                        </p>
                                    )}
                                </div>
                            </div>
                            
                            <a 
                                href={mapLink} 
                                target="_blank" 
                                rel="noreferrer"
                                className="flex items-center justify-center gap-2 w-full py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-medium transition-colors"
                            >
                                <Icon name="MapPin" size={18} />
                                View on Satellite Map
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [quakes, setQuakes] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [lastUpdated, setLastUpdated] = useState(null);
            const [userLocation, setUserLocation] = useState(null);
            const [locationStatus, setLocationStatus] = useState("idle"); // idle, loading, success, error
            
            // Filters
            const [minMag, setMinMag] = useState(2.5);
            const [selectedCountry, setSelectedCountry] = useState('All');
            const [timeRange, setTimeRange] = useState('day'); 
            const [searchTerm, setSearchTerm] = useState("");
            
            const [selectedQuake, setSelectedQuake] = useState(null);

            const getUserLocation = () => {
                setLocationStatus("loading");
                if (!navigator.geolocation) {
                    setLocationStatus("error");
                    alert("Geolocation is not supported by your browser");
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        setUserLocation({
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        });
                        setLocationStatus("success");
                    },
                    () => {
                        setLocationStatus("error");
                        alert("Unable to retrieve your location");
                    }
                );
            };

            const fetchQuakes = async () => {
                setLoading(true);
                setError(null);
                
                let endpoint = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson';
                if (timeRange === 'hour') endpoint = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson';
                if (timeRange === 'week') endpoint = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson';
                if (timeRange === 'month') endpoint = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson';

                try {
                    const res = await fetch(endpoint);
                    if (!res.ok) throw new Error(`USGS Service Unavailable`);
                    const data = await res.json();
                    if (!data || !data.features) throw new Error('Invalid Data');
                    setQuakes(data.features);
                    setLastUpdated(new Date());
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => { fetchQuakes(); }, [timeRange]);
            useEffect(() => { const i = setInterval(fetchQuakes, 60000); return () => clearInterval(i); }, [timeRange]);

            // Memoized Filtering Logic
            const processedQuakes = useMemo(() => {
                return quakes.filter(q => {
                    const props = q.properties || {};
                    const mag = props.mag || 0;
                    const place = props.place || "";
                    
                    const matchesMag = mag >= minMag;
                    const region = normalizeRegion(place);
                    const matchesCountry = selectedCountry === 'All' || region === selectedCountry;
                    const matchesSearch = searchTerm === "" || place.toLowerCase().includes(searchTerm.toLowerCase());
                    
                    return matchesMag && matchesCountry && matchesSearch;
                }).sort((a, b) => (b.properties.time || 0) - (a.properties.time || 0));
            }, [quakes, minMag, selectedCountry, searchTerm]);

            // Regions
            const regions = useMemo(() => {
                const allRegions = quakes.map(q => normalizeRegion(q.properties?.place));
                const unique = [...new Set(allRegions)].filter(Boolean).sort();
                return ['All', ...unique];
            }, [quakes]);

            // Stats
            const maxMagQuake = processedQuakes.length > 0 
                ? processedQuakes.reduce((max, q) => (q.properties.mag > max.properties.mag ? q : max), processedQuakes[0]) : null;
            const recentQuake = processedQuakes[0];
            const tsunamiCount = processedQuakes.filter(q => q.properties.tsunami === 1).length;

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 flex flex-col">
                    {/* Navbar */}
                    <nav className="border-b border-slate-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-30">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-16">
                                <div className="flex items-center gap-3">
                                    <div className="relative">
                                        <div className="ringring"></div>
                                        <div className="circle"></div>
                                        <Icon name="Activity" className="text-red-500 relative z-10" size={24} />
                                    </div>
                                    <span className="font-bold text-lg md:text-xl tracking-tight text-white">Seismic<span className="text-red-500">Watch</span></span>
                                </div>
                                <div className="flex items-center gap-3">
                                    <button 
                                        onClick={getUserLocation}
                                        className={`flex items-center gap-2 p-2 sm:px-3 sm:py-1.5 rounded-lg text-sm font-medium transition-all ${
                                            locationStatus === 'success' ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/30' : 
                                            locationStatus === 'loading' ? 'bg-slate-800 text-slate-400' :
                                            'bg-blue-600 hover:bg-blue-500 text-white'
                                        }`}
                                    >
                                        <Icon name="Navigation" size={16} className={locationStatus === 'loading' ? 'animate-spin' : ''} />
                                        <span className="hidden sm:inline">
                                            {locationStatus === 'success' ? 'Located' : locationStatus === 'loading' ? 'Locating...' : 'Locate Me'}
                                        </span>
                                    </button>
                                    
                                    {lastUpdated && (
                                        <span className="text-xs text-slate-500 hidden md:block font-mono">
                                            {lastUpdated.toLocaleTimeString()}
                                        </span>
                                    )}
                                    <button onClick={fetchQuakes} disabled={loading} className="p-2 rounded-lg bg-slate-800 text-slate-400 hover:text-white">
                                        <Icon name="RefreshCw" size={20} className={loading ? 'animate-spin' : ''} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
                        
                        {/* Error Message */}
                        {error && (
                            <div className="mb-6 bg-red-900/20 border border-red-500/50 text-red-200 p-4 rounded-xl flex items-center gap-3">
                                <Icon name="AlertTriangle" className="text-red-500" />
                                <div><p className="font-bold">Connection Error</p><p className="text-sm">{error}</p></div>
                                <button onClick={fetchQuakes} className="ml-auto px-4 py-2 bg-red-600 rounded text-sm">Retry</button>
                            </div>
                        )}

                        {/* Stats Row */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <StatCard 
                                label="Active Alerts" 
                                value={processedQuakes.length} 
                                subtext={`In past ${timeRange}`}
                                iconName="Waves"
                                colorClass="bg-blue-500/10 text-blue-500"
                            />
                            <StatCard 
                                label="Highest Magnitude" 
                                value={maxMagQuake ? maxMagQuake.properties.mag.toFixed(1) : '-'} 
                                subtext={maxMagQuake ? normalizeRegion(maxMagQuake.properties.place) : 'No Data'}
                                iconName="AlertTriangle"
                                colorClass="bg-red-500/10 text-red-500"
                            />
                            <StatCard 
                                label="Tsunami Threats" 
                                value={tsunamiCount} 
                                subtext={tsunamiCount > 0 ? "WARNING ACTIVE" : "No active threats"}
                                iconName="AlertTriangle"
                                colorClass={tsunamiCount > 0 ? "bg-red-500 text-white animate-pulse" : "bg-emerald-500/10 text-emerald-500"}
                            />
                            <StatCard 
                                label="Latest Event" 
                                value={recentQuake ? getTimeAgo(recentQuake.properties.time) : '-'} 
                                subtext={recentQuake ? `Mag ${recentQuake.properties.mag.toFixed(1)}` : 'No Data'}
                                iconName="Clock"
                                colorClass="bg-slate-700/30 text-slate-400"
                            />
                        </div>

                        {/* Controls Section */}
                        <div className="bg-slate-900 border border-slate-800 rounded-xl p-6 mb-8 shadow-lg">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold uppercase text-slate-500 flex items-center gap-2"><Icon name="Search" size={14} /> Search</label>
                                    <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="City, Region..." className="w-full bg-slate-800 border border-slate-700 text-white rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none" />
                                </div>
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold uppercase text-slate-500 flex items-center gap-2"><Icon name="Globe" size={14} /> Region</label>
                                    <select value={selectedCountry} onChange={(e) => setSelectedCountry(e.target.value)} className="w-full bg-slate-800 border border-slate-700 text-white rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none appearance-none">
                                        {regions.map(r => <option key={r} value={r}>{r}</option>)}
                                    </select>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold uppercase text-slate-500 flex items-center gap-2"><Icon name="Activity" size={14} /> Min Mag: {minMag.toFixed(1)}</label>
                                    <input type="range" min="0" max="9" step="0.1" value={minMag} onChange={(e) => setMinMag(parseFloat(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg accent-blue-500" />
                                </div>
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold uppercase text-slate-500 flex items-center gap-2"><Icon name="Clock" size={14} /> Time Range</label>
                                    <select value={timeRange} onChange={(e) => setTimeRange(e.target.value)} className="w-full bg-slate-800 border border-slate-700 text-white rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none appearance-none">
                                        <option value="hour">Past Hour</option>
                                        <option value="day">Past 24 Hours</option>
                                        <option value="week">Past 7 Days</option>
                                        <option value="month">Past 30 Days</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* List Section */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                <Icon name="Filter" size={18} className="text-blue-500" />
                                {timeRange === 'hour' ? 'Latest Hour' : timeRange === 'day' ? 'Today\'s' : timeRange === 'week' ? 'Weekly' : 'Monthly'} Events ({processedQuakes.length})
                            </h3>

                            {loading && !error && <div className="py-20 text-center text-slate-500"><div className="animate-spin inline-block w-8 h-8 border-2 border-blue-500 rounded-full border-t-transparent mb-2"></div><p>Scanning Network...</p></div>}
                            
                            {!loading && processedQuakes.length === 0 && !error && (
                                <div className="bg-slate-900 border border-slate-800 rounded-xl p-12 text-center">
                                    <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4"><Icon name="Search" size={32} className="text-slate-600" /></div>
                                    <h4 className="text-xl font-bold text-white">No Earthquakes Found</h4>
                                    <p className="text-slate-400">Try adjusting your filters.</p>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                                {processedQuakes.map((quake) => {
                                    const isTsunami = quake.properties.tsunami === 1;
                                    const coords = quake.geometry.coordinates;
                                    const distance = userLocation ? calculateDistance(userLocation.lat, userLocation.lon, coords[1], coords[0]) : null;

                                    return (
                                        <div 
                                            key={quake.id} 
                                            onClick={() => setSelectedQuake(quake)}
                                            className={`quake-card bg-slate-900 border border-slate-800 hover:border-slate-600 rounded-xl p-5 cursor-pointer relative overflow-hidden group ${isTsunami ? 'tsunami-active border-blue-500/50' : ''}`}
                                        >
                                            {isTsunami && <div className="absolute top-0 right-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg z-10">TSUNAMI WARNING</div>}
                                            
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="pr-4">
                                                    <h4 className="font-semibold text-slate-200 text-sm leading-snug group-hover:text-white transition-colors">{quake.properties.place}</h4>
                                                    <p className="text-xs text-slate-500 mt-1 font-mono">{formatTime(quake.properties.time)}</p>
                                                </div>
                                                <div className={`flex flex-col items-center justify-center w-12 h-12 rounded-lg font-bold text-lg border shadow-sm ${getMagnitudeColor(quake.properties.mag)}`}>
                                                    {quake.properties.mag.toFixed(1)}
                                                </div>
                                            </div>
                                            
                                            <div className="flex items-center justify-between text-xs text-slate-400 border-t border-slate-800 pt-3 mt-2">
                                                <div className="flex flex-col gap-1">
                                                    <div className="flex items-center gap-1.5">
                                                        <Icon name="Waves" size={12} />
                                                        <span>{coords[2]}km depth</span>
                                                    </div>
                                                    {distance !== null && (
                                                        <div className="flex items-center gap-1.5 text-emerald-400 font-medium">
                                                            <Icon name="Navigation" size={10} />
                                                            <span>{distance}km away</span>
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="flex flex-col items-end gap-1">
                                                    {quake.properties.felt > 0 && <span className="text-slate-500">{quake.properties.felt} felt reports</span>}
                                                    <span className="text-blue-500 group-hover:underline">Details &rarr;</span>
                                                </div>
                                            </div>
                                            
                                            <div className="absolute bottom-0 left-0 h-1 w-full bg-slate-800">
                                                <div className={`h-full ${getMagnitudeBg(quake.properties.mag)}`} style={{ width: `${(quake.properties.mag / 9) * 100}%` }}></div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="border-t border-slate-800/50 py-6 mt-8 bg-slate-900/30">
                        <div className="max-w-7xl mx-auto px-4 flex flex-col items-center justify-center gap-2">
                            <div className="flex items-center gap-2 text-slate-500 text-sm">
                                <Icon name="Code" size={16} />
                                <span>Platform Development</span>
                            </div>
                            <p className="text-slate-400 text-sm font-medium">
                                Developed by <a href="https://www.facebook.com/share/1DAajKHzG8/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 transition-colors underline decoration-blue-400/30 hover:decoration-blue-300">M.Sharifi</a>
                            </p>
                            <p className="text-slate-600 text-xs mt-1">Data provided by USGS Earthquake Hazards Program</p>
                        </div>
                    </footer>

                    <Modal isOpen={!!selectedQuake} onClose={() => setSelectedQuake(null)} quake={selectedQuake} userLocation={userLocation} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


